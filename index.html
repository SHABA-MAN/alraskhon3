<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>انشاء جدول حفظ</title>

    <!-- استيراد Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- استيراد الخطوط -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Tajawal:wght@400;500;700;800&family=Cairo:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Tesseract.js -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>


    <link rel="stylesheet" href="style.css">
</head>

<body class="min-h-screen pb-24">

    <!-- Modal -->
    <div id="instapayModal" class="modal-overlay">
        <div class="card-scene">
            <div id="cardObject" class="card-object">
                <div class="card-face card-front">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" class="mb-3">
                        <rect x="2" y="6" width="20" height="12" rx="2" />
                        <circle cx="12" cy="12" r="2" />
                        <path d="M6 12h.01M18 12h.01" />
                    </svg>
                    <h3 class="text-2xl font-bold tracking-wider">InstaPay</h3>
                    <p class="text-sm opacity-80 mt-1">دعم آمن وسريع</p>
                </div>
                <div class="card-face card-back">
                    <h3 class="text-lg font-bold mb-2">شكراً لدعمكم ❤️</h3>
                    <p class="text-sm text-slate-600 leading-relaxed">سيتم تحويلك الآن لدعم مطور الموقع مادياً عبر تطبيق
                        انستا باي..</p>
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-[#1a3c34] text-[#f9f7f2] sticky top-0 z-50 shadow-lg border-b-4 border-[#c5a059]">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none"
                style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px;"></div>

            <div class="flex items-center gap-3 relative z-10">
                <div class="relative">
                    <img src="logo.jpg" onerror="this.src='https://via.placeholder.com/150/1a3c34/c5a059?text=Quran'"
                        alt="شعار الموقع"
                        class="w-14 h-14 rounded-full border-2 border-[#c5a059] shadow-md object-cover bg-white p-0.5">
                </div>
                <div>
                    <h1 class="text-xl font-bold leading-tight text-[#eec96d] historical-font">انشاء جدول حفظ</h1>
                    <p class="text-xs text-emerald-100/80 font-light flex items-center gap-1">
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5 4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                        </svg>
                        هدية من مجموعة الجبال الرواسي
                    </p>
                </div>
            </div>

            <div class="flex items-center gap-2 relative z-10">
                <!-- Upload Button -->
                <button onclick="document.getElementById('uploadInput').click()" id="uploadBtn"
                    class="flex items-center gap-2 bg-[#1a3c34] hover:bg-[#2c584e] text-[#f9f7f2] px-5 py-2 rounded-full text-sm font-bold shadow-lg transition border border-[#c5a059]/30 active:scale-95">
                    <span class="hidden md:inline">قراءة من صورة</span>
                    <span class="md:hidden">قراءة</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <circle cx="9" cy="9" r="2" />
                        <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                    </svg>
                </button>
                <input type="file" id="uploadInput" accept="image/*" class="hidden" onchange="processImage(this)">

                <button onclick="downloadImage()" id="downloadBtn"
                    class="flex items-center gap-2 bg-[#0f2420] hover:bg-[#2c584e] text-[#c5a059] px-5 py-2 rounded-full text-sm font-bold shadow-lg transition border border-[#c5a059]/30 active:scale-95 disabled:opacity-50">
                    <span class="hidden md:inline">تحميل صورة</span>
                    <span class="md:hidden">تحميل</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <circle cx="8.5" cy="8.5" r="1.5" />
                        <polyline points="21 15 16 10 5 21" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div onclick="openInstaPayEffect()" class="fab-btn" title="دعم ب Instapay">
        <svg class="plane-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
    </div>

    <main class="max-w-6xl mx-auto p-4 md:p-8 gap-8 grid grid-cols-1 lg:grid-cols-12">
        <!-- Editor Section -->
        <div class="lg:col-span-4 space-y-6 order-2 lg:order-1">

            <!-- Smart Order -->
            <div class="ai-box p-5 rounded-2xl shadow-sm relative overflow-hidden card-shadow">
                <div class="flex items-center gap-2 mb-3 text-[#1a3c34] font-bold">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" />
                    </svg>
                    ترتيب الأيام (ذكي)
                </div>

                <div class="relative">
                    <input type="text" id="aiInput" onkeydown="if(event.key === 'Enter') smartReorder()"
                        class="w-full px-4 py-2.5 pl-10 bg-[#fffdf9] border border-[#c5a059]/30 rounded-xl focus:ring-1 focus:ring-[#c5a059] focus:border-[#c5a059] outline-none text-sm text-[#1a3c34] placeholder-gray-400"
                        placeholder="مثال: ابدأ بـ يوم الأحد">
                    <button onclick="smartReorder()" id="aiBtn"
                        class="absolute left-1.5 top-1.5 p-1.5 bg-[#c5a059] hover:bg-[#b8860b] text-[#1a3c34] rounded-lg transition-colors shadow-sm">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
                <p id="aiStatus" class="text-[10px] text-[#5d4037] mt-2 h-4"></p>
                <!-- OCR Status -->
                <p id="ocrStatus" class="text-[10px] text-blue-600 mt-1 min-h-[1rem] hidden"></p>
            </div>

            <!-- Card: Student Data -->
            <div class="bg-[#fffdf9] p-6 rounded-2xl shadow-sm border border-[#c5a059]/30 card-shadow">
                <h2 class="text-lg font-bold text-[#1a3c34] mb-4 flex items-center gap-2 historical-font">
                    <div class="w-1.5 h-6 bg-[#c5a059] rounded-full"></div>
                    بيانات الطالب
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-[#5d4037] mb-1.5">اسم الطالب</label>
                        <input type="text" id="inputName" oninput="updateData()"
                            class="w-full px-4 py-3 bg-[#f9f7f2] border border-[#d1d5db] rounded-xl focus:ring-1 focus:ring-[#c5a059] focus:border-[#c5a059] outline-none text-[#1a3c34] text-base"
                            value="عمرو">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-[#5d4037] mb-1.5">رقم المجموعة</label>
                        <input type="text" id="inputGroup" oninput="updateData()"
                            class="w-full px-4 py-3 bg-[#f9f7f2] border border-[#d1d5db] rounded-xl focus:ring-1 focus:ring-[#c5a059] focus:border-[#c5a059] outline-none text-[#1a3c34] text-base"
                            value="1">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-[#5d4037] mb-1.5">عنوان الأسبوع</label>
                        <input type="text" id="inputWeek" oninput="updateData()"
                            class="w-full px-4 py-3 bg-[#f9f7f2] border border-[#d1d5db] rounded-xl focus:ring-1 focus:ring-[#c5a059] focus:border-[#c5a059] outline-none text-[#1a3c34] text-base"
                            value="الثاني">
                    </div>
                </div>
            </div>

            <!-- Card: Fixed Wird -->
            <div class="bg-[#fffdf9] p-6 rounded-2xl shadow-sm border border-[#c5a059]/30 card-shadow">
                <h2 class="text-lg font-bold text-[#1a3c34] mb-4 flex items-center gap-2 historical-font">
                    <div class="w-1.5 h-6 bg-[#1a3c34] rounded-full"></div>
                    الأوراد الثابتة
                </h2>
                <div class="space-y-6">
                    <!-- Far Past -->
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-xs font-bold text-[#5d4037]">الماضي البعيد</label>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] text-gray-500">تقسيم يومي</span>
                                <input type="checkbox" id="toggleFarPast" class="toggle-checkbox"
                                    onchange="toggleMode('farPast')">
                                <label for="toggleFarPast" class="toggle-label"></label>
                            </div>
                        </div>
                        <div id="farPastMergedContainer">
                            <textarea id="inputFarPast" oninput="updateData()" rows="2"
                                class="w-full px-3 py-3 bg-[#f9f7f2] border border-[#d1d5db] rounded-xl focus:border-[#1a3c34] outline-none text-sm text-[#1a3c34]">-</textarea>
                        </div>
                        <div id="farPastDailyContainer" class="hidden space-y-4"></div>
                    </div>

                    <!-- Near Past -->
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-xs font-bold text-[#5d4037]">الماضي القريب</label>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] text-gray-500">تقسيم يومي</span>
                                <input type="checkbox" id="toggleNearPast" class="toggle-checkbox"
                                    onchange="toggleMode('nearPast')">
                                <label for="toggleNearPast" class="toggle-label"></label>
                            </div>
                        </div>
                        <div id="nearPastMergedContainer">
                            <textarea id="inputNearPast" oninput="updateData()" rows="2"
                                class="w-full px-3 py-3 bg-[#f9f7f2] border border-[#d1d5db] rounded-xl focus:border-[#1a3c34] outline-none text-sm text-[#1a3c34]">تسميع من أول سورة البقرة إلى آية ٢٥ يومياً</textarea>
                        </div>
                        <div id="nearPastDailyContainer" class="hidden space-y-4"></div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-[#5d4037] mb-1.5">التحضير</label>
                        <textarea id="inputPrep" oninput="updateData()" rows="3"
                            class="w-full px-3 py-3 bg-[#f9f7f2] border border-[#d1d5db] rounded-xl focus:border-[#1a3c34] outline-none text-sm text-[#1a3c34]">(( تلاوة ربع ))
(( أتأمرون الناس بالبر ))
والصلاة بالمحفوظ على مدار اليوم</textarea>
                    </div>
                </div>
            </div>

            <!-- Daily Hifz -->
            <div class="bg-[#fffdf9] p-6 rounded-2xl shadow-sm border border-[#c5a059]/30 card-shadow">
                <h2 class="text-lg font-bold text-[#1a3c34] mb-4 flex items-center gap-2 historical-font">
                    <div class="w-1.5 h-6 bg-[#c5a059] rounded-full"></div>
                    الحفظ اليومي
                </h2>
                <div id="rowsContainer" class="space-y-4"></div>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="lg:col-span-8 order-1 lg:order-2">
            <div id="previewContainer"
                class="bg-[#e6e2d3] rounded-3xl p-2 md:p-8 border-2 border-[#c5a059]/20 flex items-start justify-center overflow-hidden min-h-[300px] shadow-inner">

                <div id="pdfContent" class="bg-white shadow-2xl relative box-border p-8 origin-top"
                    style="font-family: 'Amiri', 'Cairo', serif;">

                    <div
                        class="flex items-start justify-between mb-6 border-b-2 border-double border-[#c5a059]/30 pb-4">
                        <div class="text-right w-1/2 pt-2">
                            <h2 class="text-5xl font-bold text-[#1a3c34] mb-2 leading-tight historical-font">
                                الأسبوع <span id="previewWeek" class="text-[#c5a059]">الثاني</span>
                            </h2>
                        </div>
                        <div class="w-1/2 flex flex-col items-end gap-2">
                            <div
                                class="bg-[#fffdf9] border-2 border-[#c5a059] rounded-xl px-6 py-3 shadow-sm w-fit min-w-[200px] relative overflow-hidden group">
                                <div class="absolute top-0 right-0 w-1.5 h-full bg-[#1a3c34]"></div>
                                <div
                                    class="flex items-center justify-between gap-4 mb-2 border-b border-[#c5a059]/20 pb-2">
                                    <span class="text-xs font-bold text-[#5d4037]">الطالب</span>
                                    <span id="previewName" class="text-lg font-bold text-[#1a3c34]">عمرو</span>
                                </div>
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-xs font-bold text-[#5d4037]">المجموعة</span>
                                    <span id="previewGroup" class="text-lg font-bold font-serif text-[#c5a059]">1</span>
                                </div>
                            </div>
                            <p class="text-[10px] text-[#1a3c34] font-medium flex items-center gap-1 opacity-80 pl-1">
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5 4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                                </svg>
                                هدية من مجموعة الجبال الرواسي
                            </p>
                        </div>
                    </div>

                    <div class="w-full border-2 border-[#1a3c34] rounded-lg overflow-hidden shadow-sm">
                        <div
                            class="flex bg-[#1a3c34] border-b-2 border-[#1a3c34] font-extrabold text-[#f9f7f2] text-2xl">
                            <div class="w-[10%] p-3 text-center border-l-2 border-[#c5a059]">اليوم</div>
                            <div class="w-[15%] p-3 text-center border-l-2 border-[#c5a059]">الماضي البعيد</div>
                            <div class="w-[25%] p-3 text-center border-l-2 border-[#c5a059]">الماضي القريب</div>
                            <div class="w-[25%] p-3 text-center border-l-2 border-[#c5a059]">الحفظ الجديد</div>
                            <div class="w-[25%] p-3 text-center">التحضير</div>
                        </div>

                        <div class="flex h-[550px]">
                            <!-- Days Column -->
                            <div class="w-[10%] flex flex-col border-l-2 border-[#1a3c34] bg-[#f0ebe0] font-bold text-2xl text-[#1a3c34]"
                                id="previewDaysCol"></div>

                            <!-- Far Past -->
                            <div class="w-[15%] border-l-2 border-[#1a3c34] bg-white vertical-cell"
                                id="previewFarPastCol"></div>

                            <!-- Near Past -->
                            <div class="w-[25%] border-l-2 border-[#1a3c34] bg-white vertical-cell"
                                id="previewNearPastCol"></div>

                            <!-- New Hifz -->
                            <div class="w-[25%] flex flex-col border-l-2 border-[#1a3c34]" id="previewNewHifzCol"></div>

                            <!-- Prep -->
                            <div class="w-[25%] bg-[#fffcf5] vertical-cell">
                                <div id="previewPrep" class="vertical-text font-bold text-xl text-[#1a3c34]"
                                    data-color="#1a3c34"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 flex justify-between items-end opacity-60">
                        <div class="text-xs text-[#5d4037]">لا تنسوا الدعاء الصالح</div>
                        <div class="flex gap-1">
                            <div class="w-2 h-2 rounded-full bg-[#c5a059]"></div>
                            <div class="w-2 h-2 rounded-full bg-[#1a3c34]"></div>
                            <div class="w-2 h-2 rounded-full bg-[#5d4037]"></div>
                        </div>
                    </div>
                </div>
            </div>
            <p class="text-center text-xs text-[#5d4037] mt-2">يمكنك تكبير الشاشة لرؤية التفاصيل بوضوح</p>
        </div>
    </main>
    <script src="script.js"></script>
</body>

</html>